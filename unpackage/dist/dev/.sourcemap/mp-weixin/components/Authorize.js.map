{"version":3,"sources":["webpack:///E:/商城/shop/components/Authorize.vue?65a9","webpack:///E:/商城/shop/components/Authorize.vue?09ed","webpack:///E:/商城/shop/components/Authorize.vue?b3c1","webpack:///E:/商城/shop/components/Authorize.vue?7c6b","uni-app:///components/Authorize.vue","webpack:///E:/商城/shop/components/Authorize.vue?c652","webpack:///E:/商城/shop/components/Authorize.vue?10bb"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkI;AAClI;AAC6D;AACL;AACsC;;;AAG9F;AACgK;AAChK,gBAAgB,6KAAU;AAC1B,EAAE,+EAAM;AACR,EAAE,gGAAM;AACR,EAAE,yGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAulB,CAAgB,mnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsB3mB;AACA;AACA;AACA;AACA;AACA,6E;;;;;;;;;;;;;;;;;;;;AANA,mB,eAQA,EACA,iBADA,EAEA,SACA,UACA,aADA,EAEA,aAFA,EADA,EAKA,aACA,aADA,EAEA,aAFA,EALA,EASA,cACA,aADA,EAEA,cAFA,EATA,EAFA,EAgBA,IAhBA,kBAgBA,CACA,SACA,WADA;AAEA,iBAFA;;AAIA,GArBA;AAsBA,0DAtBA;AAuBA;AACA,WADA,mBACA,CADA,EACA;AACA;AACA;AACA,KAJA,EAvBA;;AA6BA,SA7BA,qBA6BA;AACA;AACA;AACA;AACA;AACA,eADA,mBACA,GADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAZA,EAYA,KAZA,CAYA;AACA;AACA,WAdA;AAeA,SApBA;;AAsBA,KAvBA,MAuBA;AACA;AACA;AACA,GA1DA;AA2DA;AACA,iBADA,2BACA;AACA;AACA;AACA,4BADA;;AAGA;AACA,OALA,EAKA,KALA,CAKA;AACA;AACA;AACA,OARA;AASA,KAXA;AAYA,eAZA,uBAYA,IAZA,EAYA;AACA;AACA;AACA;AACA,mDAHA,CAGA;AACA,mDAJA,CAIA;AACA;AACA;AACA;AACA;AACA,SAJA,EAIA,KAJA,CAIA;AACA;AACA;AACA,0BADA;AAEA,wBAFA;AAGA,0BAHA;;AAKA,SAXA;AAYA,OAjBA,EAiBA,KAjBA,CAiBA;AACA;AACA,OAnBA;AAoBA,KAjCA;AAkCA,sBAlCA,8BAkCA,aAlCA,EAkCA,EAlCA,EAkCA,IAlCA,EAkCA;AACA;AACA;AACA;AACA,+BADA;AAEA,oBAFA;;AAIA;AACA;AACA;AACA,OATA,EASA,KATA,CASA;AACA;AACA;AACA,OAZA;AAaA,KAhDA;AAiDA,eAjDA,uBAiDA,CAjDA,EAiDA;AACA;AACA;AACA;AACA,OAFA,EAEA,KAFA,CAEA;AACA;AACA,OAJA;AAKA,KAxDA;AAyDA,cAzDA,wBAyDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA;AAIA,KAnEA;AAoEA,SApEA,mBAoEA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA,KA9EA,EA3DA,E;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAwmC,CAAgB,qlCAAG,EAAC,C;;;;;;;;;;;ACA5nC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/Authorize.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./Authorize.vue?vue&type=template&id=4147c09e&scoped=true&\"\nvar renderjs\nimport script from \"./Authorize.vue?vue&type=script&lang=js&\"\nexport * from \"./Authorize.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Authorize.vue?vue&type=style&index=0&id=4147c09e&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4147c09e\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/Authorize.vue\"\nexport default component.exports","export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorize.vue?vue&type=template&id=4147c09e&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorize.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorize.vue?vue&type=script&lang=js&\"","<template>\n\t<view>\n\t\t<view class='Popup' v-if='isShowAuth'>\n\t\t   <image :src='logoUrl'></image>\n\t\t   <view class='title'>授权提醒</view>\n\t\t   <view class='tip'>请授权头像等信息，以便为您提供更好的服务</view>\n\t\t   <view class='bottom flex'>\n\t\t      <view class='item' @click='close'>随便逛逛</view>\n\t\t\t  <!-- #ifdef MP -->\n\t\t\t  <button class='item grant' @click=\"setUserInfo\">去授权</button>\n\t\t\t  <!-- #endif -->\n\t\t\t  <!-- #ifdef MP -->\n\t\t\t  <button class='item grant'  type=\"primary\" open-type=\"getPhoneNumber\" lang=\"zh_CN\" @getphonenumber=\"setUserInfo\">去授权</button>\n\t\t\t  <!-- #endif -->\n\t\t   </view>\n\t\t</view>\n\t\t<view class='mask' v-if='isShowAuth' @click='close'></view>\n\t</view>\n</template>\n\n<script>\n\tconst app = getApp();\n\timport Cache from '../utils/cache';\n\timport { getLogo, silenceAuth, getUserPhone } from '../api/public';\n\timport { LOGO_URL,EXPIRES_TIME,USER_INFO,STATE_R_KEY } from '../config/cache';\n\timport { mapGetters } from 'vuex';\n\timport Routine from '../libs/routine';\n\timport store from '../store';\n\t\n\texport default {\n\t\tname:'Authorize',\n\t\tprops:{\n\t\t\tisAuto:{\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault:true\n\t\t\t},\n\t\t\tisGoIndex:{\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault:true\n\t\t\t},\n\t\t\tisShowAuth:{\n\t\t\t\ttype: Boolean,\n\t\t\t\tdefault:false\n\t\t\t}\n\t\t},\n\t\tdata(){\n\t\t\treturn {\n\t\t\t\tlogoUrl:'',\n\t\t\t\tauthKey: ''\n\t\t\t}\n\t\t},\n\t\tcomputed:mapGetters(['isLogin','userInfo']),\n\t\twatch:{\n\t\t\tisLogin(n){\n\t\t\t\tconsole.log(n);\n\t\t\t\tn === true && this.$emit('onLoadFun',this.userInfo);\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\tthis.getLogoUrl();\n\t\t\tlet that = this;\n\t\t\tif (!this.isLogin && !Cache.has(STATE_R_KEY)) {\n\t\t\t\twx.login({\n\t\t\t\t\tsuccess(res){\n\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\tCache.set(STATE_R_KEY, res.code ,10800);\n\t\t\t\t\t\tlet spread = app.globalData.spid ? app.globalData.spid : '';\n\t\t\t\t\t\tsilenceAuth({code:res.code,spread:spread,spid:app.globalData.code }).then( res => {\n\t\t\t\t\t\t\tif (res.data.key !== undefined && res.data.key) {\n\t\t\t\t\t\t\t\tthat.authKey = res.data.key;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tapp.globalData.code = 0;\n\t\t\t\t\t\t\t\tlet time = res.data.expires_time - Cache.time();\n\t\t\t\t\t\t\t\t// store.commit('UPDATE_USERINFO', res.data.userInfo);\n\t\t\t\t\t\t\t\tstore.commit('LOGIN', {token:res.data.token, time:time});\n\t\t\t\t\t\t\t\t// store.commit('SETUID', res.data.userInfo.uid);\n\t\t\t\t\t\t\t\t// Cache.set(EXPIRES_TIME,res.data.expires_time,time);\n\t\t\t\t\t\t\t\t// Cache.set(USER_INFO,res.data.userInfo,time);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}).catch(res=>{\n\t\t\t\t\t\t\tconsole.log(res);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis.setAuthStatus();\n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\tsetAuthStatus(){\n\t\t\t\tRoutine.authorize().then(res=>{\n\t\t\t\t\tif(res.islogin === false)\n\t\t\t\t\t\tthis.setUserInfo();\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.$emit('onLoadFun',this.userInfo);\n\t\t\t\t}).catch(res=>{\n\t\t\t\t\tif (this.isAuto) \n\t\t\t\t\t\tthis.$emit('authColse',true);\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetUserInfo (code) {\n\t\t\t\tRoutine.getUserInfo().then(res=>{\n\t\t\t\t\tlet userInfo = res.userInfo\n\t\t\t\t\tuserInfo.code = code;\n\t\t\t\t\tuserInfo.spread_spid = app.globalData.spid;//获取推广人ID\n\t\t\t\t\tuserInfo.spread_code = app.globalData.code;//获取推广人分享二维码ID\n\t\t\t\t\tRoutine.authUserInfo(userInfo).then(res=>{\n\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\tthis.$emit('authColse',false);\n\t\t\t\t\t\tthis.$emit('onLoadFun',this.userInfo);\n\t\t\t\t\t}).catch(res=>{\n\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle:res.msg,\n\t\t\t\t\t\t\ticon:'none',\n\t\t\t\t\t\t\tduration:2000\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t}).catch(res =>{\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetUserPhoneNumber (encryptedData,iv,code) {\n\t\t\t\tgetUserPhone({encryptedData,iv,code}).then(res => {\n\t\t\t\t\tlet time = res.data.expires_time - this.$Cache.time();\n\t\t\t\t\tthis.$store.commit('LOGIN', {\n\t\t\t\t\t\ttoken : res.data.token,\n\t\t\t\t\t\t time : time,\n\t\t\t\t\t});\n\t\t\t\t\tthis.$emit('authColse',false);\n\t\t\t\t\tthis.$emit('onLoadFun',res.data.userInfo);\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t}).catch(res => {\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t})\n\t\t\t},\n\t\t\tsetUserInfo(e){\n\t\t\t\tuni.showLoading({title:'正在登陆中'});\n\t\t\t\tRoutine.getCode().then(code => {\n\t\t\t\t\tthis.getUserPhoneNumber(e.detail.encryptedData,e.detail.iv,code);\n\t\t\t\t}).catch(res=>{\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetLogoUrl(){\n\t\t\t\tlet that = this;\n\t\t\t\tif (Cache.has(LOGO_URL)) {\n\t\t\t\t\tthis.logoUrl = Cache.get(LOGO_URL);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tgetLogo().then( res => {\n\t\t\t\t\tthat.logoUrl = res.data.logo_url\n\t\t\t\t\tCache.set(LOGO_URL,that.logoUrl);\n\t\t\t\t})\n\t\t\t},\n\t\t\tclose(){\n\t\t\t\tlet pages = getCurrentPages(), currPage  = pages[pages.length - 1];\n\t\t\t\tif(this.isGoIndex){\n\t\t\t\t\tuni.switchTab({url:'/pages/index/index'});\n\t\t\t\t} else {\n\t\t\t\t\tthis.$emit('authColse',false);\n\t\t\t\t}\n\t\t\t\t// if (currPage && currPage.isShowAuth != undefined){\n\t\t\t\t// \tcurrPage.isShowAuth = true;\n\t\t\t\t// }\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style scoped lang='scss'>\n\t.Popup{width:500rpx;background-color:#fff;position:fixed;top:50%;left:50%;margin-left:-250rpx;transform:translateY(-50%);z-index:320;}\n\t.Popup image{width:150rpx;height:150rpx;margin:-67rpx auto 0 auto;display:block;border: 8rpx solid #fff;border-radius: 50%}\n\t.Popup .title{font-size:28rpx;color:#000;text-align:center;margin-top: 30rpx}\n\t.Popup .tip{font-size:22rpx;color:#555;padding:0 24rpx;margin-top:25rpx;}\n\t.Popup .bottom .item{width:50%;height:80rpx;background-color:#eeeeee;text-align:center;line-height:80rpx;font-size:24rpx;color:#666;margin-top:54rpx;}\n\t.Popup .bottom .item.on{width: 100%}\n\t.flex{display:flex;}\n\t.Popup .bottom .item.grant{font-size:28rpx;color:#fff;font-weight:bold;background-color:#e93323;border-radius:0;padding:0;}\n\t.mask{position:fixed;top:0;right:0;left:0;bottom:0;background-color:rgba(0,0,0,0.65);z-index:310;}\n\t\n</style>\n","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorize.vue?vue&type=style&index=0&id=4147c09e&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorize.vue?vue&type=style&index=0&id=4147c09e&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1607858746160\n      var cssReload = require(\"E:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}